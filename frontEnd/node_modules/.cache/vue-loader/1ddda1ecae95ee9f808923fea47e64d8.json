{"remainingRequest":"/Users/movi/Desktop/current/frontEnd/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/movi/Desktop/current/frontEnd/src/views/eventExtraction/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/movi/Desktop/current/frontEnd/src/views/eventExtraction/index.vue","mtime":1680078813000},{"path":"/Users/movi/Desktop/current/frontEnd/node_modules/cache-loader/dist/cjs.js","mtime":1651221196058},{"path":"/Users/movi/Desktop/current/frontEnd/node_modules/babel-loader/lib/index.js","mtime":1669512949620},{"path":"/Users/movi/Desktop/current/frontEnd/node_modules/cache-loader/dist/cjs.js","mtime":1651221196058},{"path":"/Users/movi/Desktop/current/frontEnd/node_modules/vue-loader/lib/index.js","mtime":1669512954316}],"contextDependencies":[],"result":["\nimport { reqEventExtraction, deleteEventExtraction, updateEventCount } from '@/api/eventExtraction.js'\nimport { mapGetters } from 'vuex'\nimport Modal from 'ant-design-vue/lib/modal/Modal'\nimport { notification } from 'ant-design-vue'\n\nexport default ({\n  name: 'EventExtraction',\n  data() {\n    return {\n      data: null,\n      type: null,\n      columns: [\n        {\n          title: 'id',\n          key: 'id',\n          dataIndex: 'id',\n          width: \"120px\"\n        },\n        {\n          title: '公司',\n          dataIndex: 'company',\n          key: 'company',\n          width: '100px',\n          ellipsis: true\n        },\n        {\n          title: '时间',\n          dataIndex: 'date',\n          key: 'date',\n          ellipsis: true\n        },\n        {\n          title: '主题',\n          dataIndex: 'event_name',\n          key: 'event_name',\n          ellipsis: true\n        },\n        {\n          title: '经济损失',\n          dataIndex: 'loss_economic',\n          key: 'loss_economic'\n        },\n        {\n          title: '伤亡人数',\n          dataIndex: 'loss_people',\n          key: 'loss_people'\n        },\n        {\n          title: '地点',\n          dataIndex: 'position',\n          key: 'position'\n        },\n        {\n          title: '事件类别',\n          dataIndex: 'type',\n          key: 'type',\n          width: \"120px\"\n        },\n        {\n          title: '事件类型',\n          dataIndex: 'type_detail',\n          key: 'type_detail',\n          width: \"140px\"\n        },\n        {\n          title: '操作',\n          key: 'action',\n          scopedSlots: { customRender: 'action' },\n          width: \"180px\"\n        }\n      ],\n      // 分页\n      page_num: 1,\n      page_size: 10,\n      total: 0,\n      // 上传\n      uploadModalVisible: false,\n      confirmLoading: false,\n      file: null,\n      fileList: [],\n      // 更新\n      updateModalVisible: false,\n      form: {\n        event_name: \"\",\n        date: \"\",\n        position: \"\",\n        company: \"\",\n        loss_people: \"\",\n        loss_economic: \"\",\n        type: \"\",\n        type_detail: \"\"\n      },\n    }\n  },\n  computed:{\n    ...mapGetters(['roleType'])\n  },\n  methods: {\n    async handlePageChange(page_num, page_size) {\n      let res = await reqEventExtraction({ page_num: page_num, page_size: page_size })\n      this.data = res.result.event_count\n      this.total = res.result.count\n    },\n    showUploadModal(){\n      this.uploadModalVisible = true\n    },\n    handleOk(){\n      this.confirmLoading = false\n      this.uploadModalVisible = false\n      this.updateModalVisible = false\n    },\n    updateEventExtraction(record){\n      this.updateModalVisible = true\n      this.form = record\n    },\n    closeModal(){\n      this.form = {\n        event_name: \"\",\n        date: \"\",\n        position: \"\",\n        company: \"\",\n        loss_people: \"\",\n        loss_economic: \"\",\n        type: \"\",\n        type_detail: \"\"\n      }\n      this.updateModalVisible = false\n    },\n    async submitForm(){\n      this.confirmLoading = true\n      let res = await updateEventCount(this.form)\n      if(res.code === 200){\n        this.confirmLoading = false\n        this.updateModalVisible = false\n        this.getTableData()\n        notification[\"success\"]({\n          message: '更新成功',\n        });\n      }\n    },\n    async getTableData(){\n      let res = await reqEventExtraction({ page_num: 1, page_size: 10, type:this.type })\n      this.data = res.result.event_count\n      this.total = res.result.count\n      this.page_num = res.result.page_num\n      this.page_size = res.result.page_size\n    },\n    handleChange(info){\n      if (info.file.status !== 'uploading') {\n        console.log(info.file, info.fileList);\n      }\n      if (info.file.status === 'done') {\n        notification[\"success\"]({\n          message: '上传成功',\n        });\n        this.getTableData()\n      } else if (info.file.status === 'error') {\n        notification[\"error\"]({\n          message: '上传失败',\n        });\n      }\n    },\n    async handleEventChange(page_num, page_size) {\n      let res = await reqEventExtraction({ page_num: page_num, page_size: page_size })\n      this.data = res.result.event_count\n      this.total = res.result.count\n    },\n    deleteEventExtr(id) {\n      const that = this\n      this.$confirm({\n        title: 'Are you sure delete this task?',\n        content: 'Some descriptions',\n        okText: 'Yes',\n        okType: 'danger',\n        cancelText: 'No',\n        async onOk() {\n          let res = await deleteEventExtraction({ id: id })\n          if (res.code === 200) {\n            that.$notification.open({\n              message: '删除成功',\n              duration: 1\n            })\n            // this.getTableData()\n            // this.closeDialog()\n            let res = await reqEventExtraction({ page_num: 1, page_size: 10 })\n            that.data = res.result.users\n            that.total = res.result.count\n            that.page_num = res.result.page_num\n            that.page_size = res.result.page_size\n          }\n        },\n        onCancel() {\n          console.log('Cancel')\n        }\n      })\n\n    }\n  },\n  created() {\n    this.getTableData()\n  }\n})\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAmGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/eventExtraction","sourcesContent":["<template>\n  <div>\n    <div class='search-term'>\n      <a-select\n        ref=\"select\"\n        v-model:value=\"type\"\n        placeholder=\"事故类型\"\n        :allowClear='true'\n        style=\"width: 120px;margin-right: 20px\"\n      >\n        <a-select-option value=\"中毒窒息\">中毒窒息</a-select-option>\n        <a-select-option value=\"压力容器\">压力容器</a-select-option>\n        <a-select-option value=\"坍塌事故\">坍塌事故</a-select-option>\n        <a-select-option value=\"机械伤害\">机械伤害</a-select-option>\n        <a-select-option value=\"淹溺事故\">淹溺事故</a-select-option>\n        <a-select-option value=\"火灾事故\">火灾事故</a-select-option>\n        <a-select-option value=\"灼烫事故\">灼烫事故</a-select-option>\n        <a-select-option value=\"爆炸事故\">爆炸事故</a-select-option>\n        <a-select-option value=\"物体打击\">物体打击</a-select-option>\n        <a-select-option value=\"矿山事故\">矿山事故</a-select-option>\n        <a-select-option value=\"空难事故\">空难事故</a-select-option>\n        <a-select-option value=\"起重事故\">起重事故</a-select-option>\n        <a-select-option value=\"起重伤害\">起重伤害</a-select-option>\n        <a-select-option value=\"车辆伤害\">车辆伤害</a-select-option>\n        <a-select-option value=\"锅炉事故\">锅炉事故</a-select-option>\n        <a-select-option value=\"高处坠落\">高处坠落</a-select-option>\n      </a-select>\n      <a-button @click='getTableData'>查询</a-button>\n      <a-button v-if='roleType===\"admin\"' class='right' @click='showUploadModal'>上传</a-button>\n    </div>\n    <a-table :columns='columns' :data-source='data' :pagination='false'>\n      <a slot='name' slot-scope='text'>{{ text }}</a>\n      <span slot='action' slot-scope='text, record'>\n        <a-button @click=\"updateEventExtraction(record)\" type='link'>修改</a-button>\n        <a-divider type=\"vertical\" />\n        <a-button v-if='roleType===\"admin\"' @click='deleteEventExtr(record.id)' type='link'>删除</a-button>\n      </span>\n    </a-table>\n    <a-pagination\n      style='margin-top: 20px;float: right'\n      :default-current=\"page_num\"\n      :total=\"total\"\n      @change=\"handlePageChange\" />\n\n    <a-modal\n      title=\"上传事件文件\"\n      v-model:visible=\"uploadModalVisible\"\n      :confirm-loading=\"confirmLoading\"\n      @ok=\"handleOk\"\n    >\n      <a-upload\n        v-model:file-list=\"fileList\"\n        name=\"file\"\n        :multiple=\"false\"\n        action=\"/api/eventCount/upload\"\n        @change=\"handleChange\"\n      >\n        <a-button>\n          <upload-outlined></upload-outlined>\n          上传文件\n        </a-button>\n      </a-upload>\n    </a-modal>\n\n    <a-modal v-model:visible=\"updateModalVisible\" title=\"修改事件\" width='50%'>\n      <template #footer>\n        <a-button key=\"back\" @click=\"closeModal\">取消</a-button>\n        <a-button key=\"submit\" type=\"primary\" :loading=\"confirmLoading\" @click=\"submitForm\">提交</a-button>\n      </template>\n      <a-form :model=\"form\">\n        <a-form-item label=\"事故名称\">\n          <a-input v-model=\"form.event_name\" :disabled='true'/>\n        </a-form-item>\n        <a-form-item label=\"事件类别\">\n          <a-input v-model='form.type'></a-input>\n        </a-form-item>\n        <a-form-item label=\"事件类型\">\n          <a-input v-model='form.type_detail'></a-input>\n        </a-form-item>\n        <a-form-item label='时间'>\n          <a-input v-model='form.date'></a-input>\n        </a-form-item>\n        <a-form-item label=\"地点\">\n          <a-input v-model='form.position'></a-input>\n        </a-form-item>\n        <a-form-item label=\"机构\">\n          <a-input v-model='form.company'></a-input>\n        </a-form-item>\n        <a-form-item label=\"伤亡人数\">\n          <a-input v-model='form.loss_people'></a-input>\n        </a-form-item>\n        <a-form-item label=\"经济损失\">\n          <a-input v-model='form.loss_economic'></a-input>\n        </a-form-item>\n      </a-form>\n    </a-modal>\n  </div>\n</template>\n<script>\nimport { reqEventExtraction, deleteEventExtraction, updateEventCount } from '@/api/eventExtraction.js'\nimport { mapGetters } from 'vuex'\nimport Modal from 'ant-design-vue/lib/modal/Modal'\nimport { notification } from 'ant-design-vue'\n\nexport default ({\n  name: 'EventExtraction',\n  data() {\n    return {\n      data: null,\n      type: null,\n      columns: [\n        {\n          title: 'id',\n          key: 'id',\n          dataIndex: 'id',\n          width: \"120px\"\n        },\n        {\n          title: '公司',\n          dataIndex: 'company',\n          key: 'company',\n          width: '100px',\n          ellipsis: true\n        },\n        {\n          title: '时间',\n          dataIndex: 'date',\n          key: 'date',\n          ellipsis: true\n        },\n        {\n          title: '主题',\n          dataIndex: 'event_name',\n          key: 'event_name',\n          ellipsis: true\n        },\n        {\n          title: '经济损失',\n          dataIndex: 'loss_economic',\n          key: 'loss_economic'\n        },\n        {\n          title: '伤亡人数',\n          dataIndex: 'loss_people',\n          key: 'loss_people'\n        },\n        {\n          title: '地点',\n          dataIndex: 'position',\n          key: 'position'\n        },\n        {\n          title: '事件类别',\n          dataIndex: 'type',\n          key: 'type',\n          width: \"120px\"\n        },\n        {\n          title: '事件类型',\n          dataIndex: 'type_detail',\n          key: 'type_detail',\n          width: \"140px\"\n        },\n        {\n          title: '操作',\n          key: 'action',\n          scopedSlots: { customRender: 'action' },\n          width: \"180px\"\n        }\n      ],\n      // 分页\n      page_num: 1,\n      page_size: 10,\n      total: 0,\n      // 上传\n      uploadModalVisible: false,\n      confirmLoading: false,\n      file: null,\n      fileList: [],\n      // 更新\n      updateModalVisible: false,\n      form: {\n        event_name: \"\",\n        date: \"\",\n        position: \"\",\n        company: \"\",\n        loss_people: \"\",\n        loss_economic: \"\",\n        type: \"\",\n        type_detail: \"\"\n      },\n    }\n  },\n  computed:{\n    ...mapGetters(['roleType'])\n  },\n  methods: {\n    async handlePageChange(page_num, page_size) {\n      let res = await reqEventExtraction({ page_num: page_num, page_size: page_size })\n      this.data = res.result.event_count\n      this.total = res.result.count\n    },\n    showUploadModal(){\n      this.uploadModalVisible = true\n    },\n    handleOk(){\n      this.confirmLoading = false\n      this.uploadModalVisible = false\n      this.updateModalVisible = false\n    },\n    updateEventExtraction(record){\n      this.updateModalVisible = true\n      this.form = record\n    },\n    closeModal(){\n      this.form = {\n        event_name: \"\",\n        date: \"\",\n        position: \"\",\n        company: \"\",\n        loss_people: \"\",\n        loss_economic: \"\",\n        type: \"\",\n        type_detail: \"\"\n      }\n      this.updateModalVisible = false\n    },\n    async submitForm(){\n      this.confirmLoading = true\n      let res = await updateEventCount(this.form)\n      if(res.code === 200){\n        this.confirmLoading = false\n        this.updateModalVisible = false\n        this.getTableData()\n        notification[\"success\"]({\n          message: '更新成功',\n        });\n      }\n    },\n    async getTableData(){\n      let res = await reqEventExtraction({ page_num: 1, page_size: 10, type:this.type })\n      this.data = res.result.event_count\n      this.total = res.result.count\n      this.page_num = res.result.page_num\n      this.page_size = res.result.page_size\n    },\n    handleChange(info){\n      if (info.file.status !== 'uploading') {\n        console.log(info.file, info.fileList);\n      }\n      if (info.file.status === 'done') {\n        notification[\"success\"]({\n          message: '上传成功',\n        });\n        this.getTableData()\n      } else if (info.file.status === 'error') {\n        notification[\"error\"]({\n          message: '上传失败',\n        });\n      }\n    },\n    async handleEventChange(page_num, page_size) {\n      let res = await reqEventExtraction({ page_num: page_num, page_size: page_size })\n      this.data = res.result.event_count\n      this.total = res.result.count\n    },\n    deleteEventExtr(id) {\n      const that = this\n      this.$confirm({\n        title: 'Are you sure delete this task?',\n        content: 'Some descriptions',\n        okText: 'Yes',\n        okType: 'danger',\n        cancelText: 'No',\n        async onOk() {\n          let res = await deleteEventExtraction({ id: id })\n          if (res.code === 200) {\n            that.$notification.open({\n              message: '删除成功',\n              duration: 1\n            })\n            // this.getTableData()\n            // this.closeDialog()\n            let res = await reqEventExtraction({ page_num: 1, page_size: 10 })\n            that.data = res.result.users\n            that.total = res.result.count\n            that.page_num = res.result.page_num\n            that.page_size = res.result.page_size\n          }\n        },\n        onCancel() {\n          console.log('Cancel')\n        }\n      })\n\n    }\n  },\n  created() {\n    this.getTableData()\n  }\n})\n</script>"]}]}